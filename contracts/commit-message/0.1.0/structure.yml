# Commit Message Structure Contract
# Version: 0.1.0
# Formal specification for semantic commit messages

version: "0.1.0"
name: "Semantic Commit Message Structure"
description: "Formal contract defining commit message structure for multi-module mono-repository"

# STRUCTURE SPECIFICATION
structure:
  - section: "top_level_heading"
    required: true
    format: "# <module|multi-module>: <type>: <summary>"
    max_length: 72
    examples:
      - "# multi-module: feat: add commit message validation"
      - "# cli: fix: resolve command parsing error"

  - section: "top_level_body"
    required: true
    description: "Plain text body directly after top-level heading (no section header)"
    format: "2-4 sentences describing all changes"
    max_line_length: 72

  - section: "module_sections"
    required: true
    format: "## <module-name>"
    subsections:
      - "module_subject_line: <module>: <type>: <description> (72 chars max)"
      - "module_body: Detailed changes (wrapped at 72 chars)"

# SEMANTIC TYPES
semantic_types:
  - "feat"      # New feature
  - "fix"       # Bug fix
  - "refactor"  # Code restructuring
  - "docs"      # Documentation
  - "chore"     # Maintenance
  - "test"      # Tests
  - "perf"      # Performance
  - "style"     # Formatting

# MODULE SUBJECT LINE FORMAT
subject_line_format: "<module>: <type>: <description>"

# CONSTRAINTS
constraints:
  max_line_length: 72  # HARD LIMIT - applies to Summary and module body text
  no_trailing_periods: true
  code_blocks_closed: true
  module_header_no_colons: true

# LINE WRAPPING RULES
wrapping:
  top_level_body: 72    # CRITICAL: Every line in top-level body MUST be ≤72 chars
  module_body: 72       # CRITICAL: Every line in module body MUST be ≤72 chars
  exceptions:
    - "Code blocks (``` ... ```)"
    - "YAML blocks"

# MARKDOWN RULES
markdown_rules:
  - rule: "MD041"
    description: "First line must be top-level heading with conventional commit format"
    check: "First line matches '# <module|multi-module>: <type>: <summary>'"

  - rule: "MD022"
    description: "Headers should be surrounded by blank lines"
    check: "Blank line after module headers"
    severity: "warning"

  - rule: "MD026"
    description: "Trailing punctuation in heading"
    check: "Top-level heading and module subject lines must not end with period"

# ANTI-CORRUPTION LAYER
# Agents output pure content only - no meta-commentary
anti_corruption:
  enforcement: "extractContentBlock() function"
  forbidden_prefixes:
    - "Based on"
    - "Here is"
    - "Here's"
    - "Let me"
    - "I will"
    - "I'll"
    - "I've"
    - "The title"
    - "After reviewing"
  no_emojis: true
  no_wrapper_text: true
