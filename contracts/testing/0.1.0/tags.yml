# Test Tagging System Specification
# Contract for test classification and dependency management
# Version: 0.1.0

metadata:
  version: "0.1.0"
  description: "Formal specification for test tagging system across all test frameworks"
  scope: "Applies to Gherkin features, Go tests, and future test frameworks"

tags:
  - tag: "@deps:docker"
    description: "Requires Docker daemon to be running"
    type: system_dependency

  - tag: "@deps:git"
    description: "Requires Git CLI to be available"
    type: system_dependency

  - tag: "@deps:go"
    description: "Requires Go toolchain to be available"
    type: system_dependency

  - tag: "@deps:claude"
    description: "Requires Claude API access and credentials"
    type: system_dependency

  - tag: "@deps:az-cli"
    description: "Requires Azure CLI to be available"
    type: system_dependency

  - tag: "@depm:src-cli"
    description: "Requires built CLI module (out/src-cli/r2r-cli.exe on Windows, r2r-cli on Unix)"
    type: module_dependency

  - tag: "@depm:src-commands"
    description: "Requires commands module (go run from src/commands)"
    type: module_dependency

  - tag: "@depm:src-core"
    description: "Requires core library module (Go library)"
    type: module_dependency

  - tag: "@L0"
    name: "Very Fast Unit Tests with direct access to source files and build artifacts"
    type: taxonomy-level

  - tag: "@L1"
    name: "Fast Unit Tests with direct access to source files and build artifacts"
    type: taxonomy-level

  - tag: "@L2"
    name: "Emulated System Tests with access to emulator and build artifacts"
    type: taxonomy-level

  - tag: "@L3"
    name: "Production-like System Tests with access to in-situ environment and build artifacts deployed to it"
    type: taxonomy-level

  - tag: "@L4"
    name: "Production System Tests with access to in-situ environment and build artifacts deployed to it"
    type: taxonomy-level

  - tag: "@ov"
    name: "Operational Verification"
    description: "Functional tests verifying feature behavior"
    type: verification

  - tag: "@iv"
    name: "Installation Verification"
    type: verification

  - tag: "@pv"
    name: "Performance Verification"
    description: "Load tests and performance benchmarks"
    type: verification

  - tag: "@piv"
    name: "Production Installation Verification"
    description: "Smoke tests in production post-deployment"
    type: verification

  - tag: "@ppv"
    name: "Production Performance Verification"
    description: "Production monitoring and performance validation"
    type: verification

  - tag: "@requires_isolation"
    description: "Test must run in isolation with proper setup/teardown"
    type: safety

  - tag: "@risk:<risk-id>"
    description: "Tag specific risks for tracking and mitigation"
    type: safety

  - tag: "@ignore"
    description: "Exclude from all test suite runs (work-in-progress features)"
    type: execution_control
    level: feature-or-scenario

  - tag: "@Manual"
    description: "Manual test requiring human execution and evidence collection"
    type: execution_control
    level: scenario

  - tag: "@risk-control:<name>-<id>"
    description: "Link to risk control specification"
    type: risk_control
    level: scenario
    pattern: "^@risk-control:[a-z0-9-]+-[0-9]{2}$"
    example: "@risk-control:auth-mfa-01"

  - tag: "@risk-control:gxp-<name>"
    description: "Link to GxP risk control specification"
    type: risk_control_gxp
    level: scenario
    pattern: "^@risk-control:gxp-[a-z0-9-]+$"
    example: "@risk-control:gxp-account-lockout"

  - tag: "@gxp"
    description: "GxP-related requirement (must have @risk-control:gxp-<name>)"
    type: gxp_regulatory
    level: feature-or-scenario

  - tag: "@critical-aspect"
    description: "GmP Critical Aspect (GmP products only, must be used with @gxp)"
    type: gxp_regulatory
    level: scenario

# ============================================================================
# Tag Type Definitions
# ============================================================================

types:
  - type: system_dependency
    description: "External system dependencies required for test execution (e.g., docker, git, go)"

  - type: module_dependency
    description: "Internal module dependencies required for test execution (e.g., src-cli, src-commands, src-core)"

  - type: taxonomy-level
    description: "Test environment complexity and isolation level (L0-L4)"

  - type: verification
    description: "What aspect of the system is being verified (operational, installation, performance)"

  - type: safety
    description: "Tags related to test isolation, cleanup, and risk tracking"

  - type: execution_control
    description: "Control test execution behavior (ignore, manual)"

  - type: risk_control
    description: "Link scenarios to risk control specifications"

  - type: risk_control_gxp
    description: "Link GxP scenarios to GxP-specific risk controls"

  - type: gxp_regulatory
    description: "GxP regulatory classification and critical aspects"
