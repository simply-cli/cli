# DR-003: Use Three-Layer Testing Approach (ATDD/BDD/TDD)

## Status

- [x] Accepted
- [ ] Proposed
- [ ] Rejected
- [ ] Deprecated
- [ ] Superseded

**Date**: 2025-11-03

---

## Context

Testing needs: executable business requirements, collaboration, traceability, compliance, multi-language support.

**Problem**: How to bridge business requirements and technical implementation?

---

## Decision

**Three-layer testing** with single `specification.feature` file:

**Layer 1 - ATDD**: Gherkin Rule blocks (acceptance criteria from Example Mapping Blue Cards)
**Layer 2 - BDD**: Gherkin Scenarios under Rules (examples from Green Cards)
**Layer 3 - TDD**: Go unit tests (`*_test.go`)

**Organization**:

```text
specs/<module>/<feature>/specification.feature  # ATDD + BDD
src/<module>/tests/steps_test.go                # Step definitions
src/<module>/*_test.go                          # Unit tests
```

**Example**:

```gherkin
Feature: cli_init-project
  Rule: System initializes project structure
    @success @ac1
    Scenario: Initialize in empty directory
      Given I am in an empty directory
      When I run "r2r init"
      Then the project structure should be created
```

**Mapping**: Feature → Feature ID, Rule → Blue Card, Scenario → Green Card, @ac1 → acceptance criterion link

---

## Consequences

**Positive**: Traceability, stakeholder-readable, single source, compliance support, multi-language

**Negative**: Learning curve (Gherkin, DDD concepts), workshop overhead, slower execution

---

## Alternatives Considered

1. **Separate ATDD/BDD Files**: Rejected - duplication, sync issues
2. **TDD with Separate Docs**: Rejected - divergence, no executable requirements
3. **BDD Without Rule Blocks**: Rejected - no AC structure, missing ATDD layer

---

## Related Decisions

- [DR-007: Verification Tags for Regulatory Compliance](dr007.md)
- [DR-008: Feature Specifications Structure](dr008.md)
